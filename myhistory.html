<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width,viewport-fit=cover, initial-scale=1.0, maximum-scale=1.0,user-scalable=0" />
	<meta name="applicable-device" content="pc,mobile"/>
	<meta name="apple-mobile-web-app-capable" content="yes"/>
	<meta name="apple-touch-fullscreen" content="yes"/>
	<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
	<meta name="format-detection" content="telephone=no"/>
	<meta http-equiv="X-UA-Compatible" content="edge">
	<meta name="x5-fullscreen" content="true">
	<meta name="full-screen" content="yes">
	<meta name="wap-font-scale" content="no">
	<script src="js/flexible.js"></script>
	<title>智慧居家养老平台</title>
	<link rel="apple-touch-icon" type="image/jpg" href="">
	<link rel="icon" type="image/jpg" href="">
    <link rel="stylesheet" href="css/iconfont.css" />
	<link rel="stylesheet" href="css/base.css" />

</head>
<body>
	<div class="container croll">
		<header class="headerUser">
			<div class="hederHomeBanner">
				<a href="javascript:history.go(-1)" class="iconfont headIconPic">&#xe65f;</a>    			
				<h2>我的足迹</h2>
				<div class="histroyrig_shai">编辑</div>
			</div>
		</header>
		<div class="histroycart">
			<div class="Carthistroy-item">					
				<div class="Carthistroy-item-contain">						
					<div class="CartOrderhistroy">
						<div class="histroy">
							<div class="histroy-group-item">
								<div class="histroy-info">	
									<div class="histroy-check-box">
										<label class="histroy-checkbox">
							                <input type="checkbox" name="cartcheck" class="check goods-check goodshistroyCheck">
							                <i class="icon-histroy-checkbox"></i>
										</label>	
									</div>
									<div class="histroy-info-text clearfix">											
										<div class="histroy-info-img"><a href="productdetail.html"><img src="https://img12.360buyimg.com/n2/s270x270_jfs/t1/222615/37/4792/422959/61ab2cd0Ea63ae74f/66febe2cbec2d061.jpg" /></a></div>
										<div class="histroyitem flex">
											<div class="histroy-message">
												<a href="productdetail.html" class="histroy-message-name">美盾阿胶红枣蛋白粉营养健康蛋白质粉中老年人养生固体饮料营养粉 320g/罐</a>
											</div>
											<div class="mui-mark"><span class="mark-zt">满200减10</span></div>
											<div class="histroy-counts">
												<div class="histroy-pices clearfix">
													<b class="price fr">&yen;168.00</b>
													<a href="javascript:Tocart()" class="iconfont mui-cart">&#xe624;</a>
												</div>
												<div class="histroy-arithmetic clearfix">
													<div class="histroy-good-tips fl">库存不足</div>
												</div>
												
											</div>
											<input type="hidden" class="histroyTotal" value="0.00" />
										</div>
									</div>	
								</div>
							</div>
							<div class="histroy-group-item">
								<div class="histroy-info">	
									<div class="histroy-check-box">
										<label class="histroy-checkbox">
							                <input type="checkbox" name="cartcheck" class="check goods-check goodshistroyCheck">
							                <i class="icon-histroy-checkbox"></i>
										</label>	
									</div>
									<div class="histroy-info-text clearfix">											
										<div class="histroy-info-img"><a href="productdetail.html"><img src="https://img12.360buyimg.com/n2/s270x270_jfs/t1/188959/35/21916/150920/62441b88E5a6627bc/4e0f058ac1efe8a1.jpg" /></a></div>
										<div class="histroyitem flex">
											<div class="histroy-message">
												<a href="productdetail.html" class="histroy-message-name">张奶奶100%活海刺参肽粉精华肽冲饮小分子专利技术无添加多种蛋白 实惠装 老少皆宜滋补营养健康易吸收 实惠装90g 【3g*10袋*3盒】</a>
											</div>
											<div class="mui-mark"><span class="mark-zt">满200减10</span></div>
											<div class="histroy-counts">
												<div class="histroy-pices clearfix">
													<b class="price fr">&yen;1190.00</b>
													<a href="javascript:Tocart()" class="iconfont mui-cart">&#xe624;</a>
												</div>
											</div>
											
											<input type="hidden" class="histroyTotal" value="0.00" />
										</div>
									</div>	
								</div>
							</div>
							<div class="histroy-group-item">
								<div class="histroy-info">	
									<div class="histroy-check-box">
										<label class="histroy-checkbox">
							                <input type="checkbox" name="cartcheck" class="check goods-check goodshistroyCheck">
							                <i class="icon-histroy-checkbox"></i>
										</label>	
									</div>
									<div class="histroy-info-text clearfix">											
										<div class="histroy-info-img"><a href="productdetail.html"><img src="https://img14.360buyimg.com/n2/s270x270_jfs/t1/220810/21/15967/298682/62410d41E9a88fc73/2c46e7c435bea914.jpg" /></a></div>
										<div class="histroyitem flex">
											<div class="histroy-message">
												<a href="productdetail.html" class="histroy-message-name">福东海 新会老陈皮100g 典藏礼罐装 约十五年 新会源产陈皮干 大红皮 茶叶花草茶泡水 精选老皮 送礼佳品</a>
											</div>
											<div class="mui-mark"><span class="mark-zt">满200减10</span></div>
											<div class="histroy-counts">
												<div class="histroy-pices clearfix">
													<b class="price fr">&yen;98.00</b>
													<a href="javascript:Tocart()" class="iconfont mui-cart">&#xe624;</a>
												</div>
											</div>
											<input type="hidden" class="histroyTotal" value="0.00" />
										</div>
									</div>	
								</div>
							</div>		
							<div class="histroy-group-item">
								<div class="histroy-info">	
									<div class="histroy-check-box">
										<label class="histroy-checkbox">
							                <input type="checkbox" name="cartcheck" class="check goods-check goodshistroyCheck">
							                <i class="icon-histroy-checkbox"></i>
										</label>	
									</div>
									<div class="histroy-info-text clearfix">											
										<div class="histroy-info-img"><a href="productdetail.html"><img src="https://img10.360buyimg.com/n2/s240x240_jfs/t1/197570/20/17364/90553/6194b9b8Ef021c25f/3fe85d245b930780.jpg" /></a></div>
										<div class="histroyitem flex">
											<div class="histroy-message">
												<a href="productdetail.html" class="histroy-message-name">ober康复机器人手套手部训练器材中风偏瘫气动锻炼手</a>
											</div>
											<div class="mui-mark"><span class="mark-zt">满200减10</span></div>
											<div class="histroy-counts">
												<div class="histroy-pices clearfix">
													<b class="price fr">&yen;1180.00</b>
													<a href="javascript:Tocart()" class="iconfont mui-cart">&#xe624;</a>
												</div>
											</div>
											<input type="hidden" class="histroyTotal" value="0.00" />
										</div>
									</div>	
								</div>
							</div>		
							<div class="histroy-group-item">
								<div class="histroy-info">	
									<div class="histroy-check-box">
										<label class="histroy-checkbox">
							                <input type="checkbox" name="cartcheck" class="check goods-check goodshistroyCheck">
							                <i class="icon-histroy-checkbox"></i>
										</label>	
									</div>
									<div class="histroy-info-text clearfix">											
										<div class="histroy-info-img"><a href="productdetail.html"><img src="https://img12.360buyimg.com/n2/s270x270_jfs/t1/150576/11/21157/207297/623eb54bEdede9b71/4e6aed6482781a81.jpg" /></a></div>
										<div class="histroyitem flex">
											<div class="histroy-message">
												<a href="productdetail.html" class="histroy-message-name">中量肘关节康复训练器手臂屈伸牵引器胳膊骨折支架上肢脱臼术后锻炼中风偏瘫 肘关节康复器</a>
											</div>
											<div class="mui-mark"><span class="mark-zt">满200减10</span></div>
											<div class="histroy-counts">
												<div class="histroy-pices clearfix">
													<b class="price fr">&yen;1189.00</b>
													<a href="javascript:Tocart()" class="iconfont mui-cart">&#xe624;</a>
												</div>
											</div>
											<input type="hidden" class="histroyTotal" value="0.00" />
										</div>
									</div>	
								</div>
							</div>	
						</div>
						<div class="center" id="emptyimg">
							<img class="emptyimg" src="static/images/bottom.png" />
						</div>
						
						<div class="payment-bar mui-fixed histroybottom" id="histroybottom">
							
							<div class="payment-r-box box">
								<div class="all-histroy-checkbox">
									<label class="histroy-checkbox">
									    <input type="checkbox" class="AllhistroyCheck check goods-check goodshistroyCheck">
									    <i class="icon-histroy-checkbox"></i>全选
									</label>	
								</div>
								<input class="histroyTotalNum" type="hidden" />
								<a class="addgoCart">加入购物车</a>
								<a class="histroy-delete-settle">删除</a>
							</div>
						</div>
					
					</div>
				</div>
			</div>	
			
		</div>
	</div>
	
	
	<!--返回顶部-->
  	<a class="totop iconfont">&#xe60e;</a>	
	<script type="text/javascript" src="js/jquery-3.1.1.min.js" ></script>
	<script type="text/javascript" src="js/layer_mobile/layer.js"></script>
	<script type="text/javascript" src="js/common.js" ></script>

	<script>
		
		$(".histroyrig_shai").click(function() {
		    if ($(this).html() == "编辑") {
		        $(this).html("完成");
		        $(".histroy-delete-settle").css('display','flex');
		        $(".addgoCart").css('display','flex');
		        $(".histroy-check-box").css('display','flex');
		        $("#histroybottom").show();
		    } else {
		        $(this).html("编辑");
		        $(".histroy-delete-settle").hide();
		        $(".addgoCart").hide();
		        $(".histroy-check-box").hide();
		        $("#histroybottom").hide();
		    }
		})
		

		$(function(){
			if($('.histroynum').val()<=1){
				$(this).val(1);
				$('.histroyminus').attr('disabled',true);
			}
		})
			
		// 数量减
		$(".histroyminus").click(function() {
			var s = $(this).parent().parent().find('.histroynum');
			s.val(parseInt(s.val()) - 1);
			if (s.val() <= 1 ) {
				s.val(1);
				$(this).attr('disabled',true);
			}
			loading();
			Totalhistroy();
		});
			
		// 数量加
		$(".histroyplus").click(function() {
			var s = $(this).parent().parent().find('.histroynum');
			$obj = $(this).parents('.histroy-arithmetic').find('.histroyminus'),
			s.val(parseInt(s.val()) + 1);
			if (s.val() <= 1) {
				s.val(1);
			}
			if(s.val() >1){
				$obj.attr('disabled',false);
			}
				
			loading();
			Totalhistroy();
		});
			
		//购物车为空
					
		Emptyhistroy=function(){
			var empty='';
			empty+='<div class="EmptyhistroyContent clearfix">'
				+	'<div class="EmptyhistroyTop">'
				+		'<i class="iconfont Emptyhistroys">&#xe758;</i>'
				+	'</div>'
				+	'<div class="EmptyhistroyBottom">'
				+		'<p>您还没有浏览记录，快去看看吧~~</p>'
				+		'<p><a href="index.html" class="ToIndexBtn">去逛逛</a></p>'
				+	'</div>'
				+'</div>'
			$('.histroycart').append(empty);
					
		}
		
		
		//全选和全不选
			        
		$('.AllhistroyCheck').bind('click',function(){
			if(this.checked){    //全选
			    $("input[name='cartcheck']").each(function(){
			        $(this).prop('checked',true);
			    })
			    Totalhistroy();
			}else{    //全不选
			    $("input[name='cartcheck']").each(function(){
			        $(this).prop('checked',false);
			    })
			    Totalhistroy();
			}
			loading();
		});
	        
		//所有的子项选中或者不全选中后，全选按钮也选中或者不选中
		$(".CartOrderhistroy input[type='checkbox']").change(function(){
			var allLength=$("input[name='cartcheck']").length; //所有的checkbox的长度
			$("input[name='cartcheck']").each(function(){
				$(this).bind('click',function(){
				    var selectedLength=$("input[name='cartcheck']:checked").length;//所有的选中的checkbox的长度
				    if(selectedLength==allLength){
				        $('.AllhistroyCheck').prop("checked",true);//全选按钮
				    }else{
				        $('.AllhistroyCheck').prop("checked",false);
				    }
				    Totalhistroy();
				    loading();
				})
			})
			Totalhistroy();
		})
		
		
		//计算
		function Totalhistroy() {
			var allnum = 0;
			$(".histroy-group-item").each(function() { 
				var nums=0;
				$(this).find(".goodshistroyCheck").each(function() { 
					if ($(this).is(":checked")) { 
						var num = parseInt($(this).parents(".histroy-info").find(".histroynum").val()); //数量
						nums+=num;
					}
					$(this).closest(".histroy-group-item").find(".histroynum").text(nums);
				});
						      
				var onenum = parseFloat($(this).find(".histroynum").text()); 
				allnum += onenum;//已选商品总数量
		
			});
 
			if(allnum!=0){
				$(".histroyTotalNum").text(allnum);
				$(".histroyTotalNum").show();
			}else{
				$(".histroyTotalNum").hide();
			}
			
		}
		
		//购物车为空
		function Histroyhide(){
			if($(".histroy").children().hasClass('histroy-group-item')==false){
				$(".Carthistroy-item").remove();
				$(".reminder").hide();// 购物车为空时不显示温馨提示
				Emptyhistroy();
			}
		}
		
		//点击批量取消
					
		$(".histroy-delete-settle").click(function(){
			var $histroyTotalNum=$(".histroyTotalNum").text();
			ModalHelper.afterOpen();
			if($("input:checkbox[name='cartcheck']:checked").length == 0){
				layer.open({
		        	content: '<i class="iconfont" style="vertical-align: middle;margin-right:5px;">&#xe614;</i><span style="vertical-align: middle;">请选择要删除的商品</span>',
		        	style:'font-size:0.28rem;',
		        	skin: 'msg',
		        	time: 1, //2秒后自动关闭
		        	end:function(){//层销毁
				    	ModalHelper.beforeClose();
				    }
		        });
				
			}else{
				layer.open({
					shadeClose: false, //禁止遮罩关闭
					content:'<i class="iconfont" style="vertical-align: middle;font-size:1rem;color: #2C6BFF;">&#xe636;</i><p style="font-size: 0.28rem;text-align: center;"> 是否确认将已选中的<span style="display: inline-block;font-size: 16px;font-weight: bold;color:#FA4A66;vertical-align: -1px;margin: 0 3px;">'+$histroyTotalNum+'</span>件商品删除？</p>',
					btn:['确认','取消'],
					no:function(){//取消
						ModalHelper.beforeClose();
					},
					yes: function(index, layero){//确认
						ModalHelper.beforeClose();
		                layer.close(index); //如果设定了yes回调，需进行手工关闭
		                
		                $("input[name='cartcheck']:checked").each(function(){
							var n=$(this).parent().parent().parent().parent().index();
							$(".histroy").find(".histroy-group-item:eq("+n+")").remove();
							layer.open({
			                	content: '<i class="iconfont" style="vertical-align: middle;margin-right:5px;">&#xe640;</i><span style="vertical-align: middle;">删除成功!</span>',
			                	style:'font-size:0.28rem;',
			                	skin: 'msg',
			                	time: 2 //2秒后自动关闭
			                });
							Totalhistroy();
							Histroyhide();
						})		                
					}
				})
			}	

		})	
		
		
		//点击批量加入购物车
					
		$(".addgoCart").click(function(){
			var $histroyTotalNum=$(".histroyTotalNum").text();
			ModalHelper.afterOpen();
			if($("input:checkbox[name='cartcheck']:checked").length == 0){
				layer.open({
		        	content: '<i class="iconfont" style="vertical-align: middle;margin-right:5px;">&#xe614;</i><span style="vertical-align: middle;">请选择要加入购物车的商品</span>',
		        	style:'font-size:0.28rem;',
		        	skin: 'msg',
		        	time: 1, //2秒后自动关闭
		        	end:function(){//层销毁
				    	ModalHelper.beforeClose();
				    }
		        });
				
			}else{
				layer.open({
					shadeClose: false, //禁止遮罩关闭
					content:'<i class="iconfont" style="vertical-align: middle;font-size:1rem;color: #2C6BFF;">&#xe636;</i><p style="font-size: 0.28rem;text-align: center;"> 是否确认将已选中的<span style="display: inline-block;font-size: 16px;font-weight: bold;color:#FA4A66;vertical-align: -1px;margin: 0 3px;">'+$histroyTotalNum+'</span>件商品加入购物车？</p>',
					btn:['确认','取消'],
					no:function(){//取消
						ModalHelper.beforeClose();
					},
					yes: function(index, layero){//确认
						ModalHelper.beforeClose();
		                layer.close(index); //如果设定了yes回调，需进行手工关闭
		                
		                $("input[name='cartcheck']:checked").each(function(){
							layer.open({
			                	content: '<i class="iconfont" style="vertical-align: middle;margin-right:5px;">&#xe640;</i><span style="vertical-align: middle;">加入购物车成功!</span>',
			                	style:'font-size:0.28rem;',
			                	skin: 'msg',
			                	time: 2 //2秒后自动关闭
			               });
						})		                
					}
				})
			}	

		})
		
		//加入购物车
		function Tocart(){
	    	layer.open({
	        	content: '<i class="iconfont" style="vertical-align: middle;margin-right:5px;">&#xe640;</i><span style="vertical-align: middle;">加入购物车成功!</span>',
	        	style:'font-size:0.28rem;',
	        	skin: 'msg',
	        	time: 2 //2秒后自动关闭
	        });
	    }
		
		//收藏	    	
        $('.mud-action .mui-collect').click(function(){
        	var followButton = $(this);
			if (followButton.hasClass("following")){       
	            followButton.removeClass("following");       
	            followButton.html('&#xe623;');
	            followButton.css({'color':'#606060'});
	        }else{
	            followButton.addClass("following");  
	            followButton.html('&#xe602;'); 
	            followButton.css({'color':'#FA4A66'});
	        }
        })

		$(function(){
			//超过一屏显示没有更多图片
			function emptyimgbottom(){
				if($(window).height()>document.body.clientHeight){
					$("#emptyimg").css({'display':'-webkit-box'});
				}
			}
			emptyimgbottom()
			
		})

	</script>
</body>
</html>